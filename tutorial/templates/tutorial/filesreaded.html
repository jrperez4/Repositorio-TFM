{% extends "tutorial/layout.html" %}
{% block content %}

<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>

<style>
  .filterable {
    margin-top: 15px;
}
.filterable .panel-heading .pull-right {
    margin-top: -20px;
}
.filterable .filters input[disabled] {
    background-color: transparent;
    border: none;
    cursor: auto;
    box-shadow: none;
    padding: 0;
    height: auto;
}
.btn-info{
    background-color: #343a40;
    border-color: #343a40;
}
.btn-info:hover{
    background-color: #56606a;
    border-color: #343a40;
    transition: background-color .5s;
}

.styled-table {
    border-collapse: collapse;
    margin: 25px 0;
    font-size: 0.9em;
    font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
    min-width: 400px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
}
.styled-table thead tr {
    background-color: #343a40;
    color: #ffffff;
    text-align: left;
}
.styled-table th,
.styled-table td {
    padding: 12px 15px;
}

.styled-table tbody tr {
    border-bottom: 1px solid #dddddd;
}

.styled-table tbody tr:nth-of-type(even) {
    background-color: #f3f3f3;
}

.styled-table tbody tr:last-of-type {
    border-bottom: 4px solid #343a40;
}
.styled-table tbody tr.active-row {
    font-weight: bold;
    color: #343a40;
}
tr {
  background-color: #FCFCFC;
  transition: background-color .5s;
}

tr:hover {
  background-color: #F0F0F0;
}

tr:hover td {
    -moz-box-shadow: 0 4px 2px -3px rgba(0, 0, 0, 0.5) inset;
    -webkit-box-shadow: 0 4px 2px -3px rgba(0, 0, 0, 0.5) inset;
    box-shadow: 0 4px 2px -3px rgba(0, 0, 0, 0.5) inset;
}
tr:hover td:first-child {
    -moz-box-shadow: 4px 4px 2px -3px rgba(0, 0, 0, 0.5) inset;
    -webkit-box-shadow: 4px 4px 2px -3px rgba(0, 0, 0, 0.5) inset;
    box-shadow: 4px 4px 2px -3px rgba(0, 0, 0, 0.5) inset;
}
tr:hover td:last-child {
    -moz-box-shadow: 0 4px 2px -3px rgba(0, 0, 0, 0.5) inset;
    -webkit-box-shadow: 0 4px 2px -3px rgba(0, 0, 0, 0.5) inset;
    box-shadow: 0 4px 2px -3px rgba(0, 0, 0, 0.5) inset;
}

 #custom-button {
  border-radius: 4px;
  background-color: #F2BE66;
  border: none;
  color: #FFFFFF;
  text-align: center;
  font-size: 11px;
  padding: 15px;
  width: 165px;
  transition: all 0.5s;
  cursor: pointer;
  margin: 5px;
}
   #custom-button span{
     cursor: pointer;
     display: inline-block;
     position: relative;
     transition: 0.5s;

}
#custom-button span:after{
  content: '\274F';
  position: absolute;
  opacity: 0;
  top: 0;
  right: -20px;
  transition: 0.5s;
}

#custom-button:hover {
  background-color: #A67624;
}

#custom-button:hover span{
   padding-right: 25px;
}
#custom-button:hover span:after{
    opacity: 1;
    right: 0;
}

#custom-text {
  margin-left: 10px;
  font-family: sans-serif;
  color: #aaa;
}


#custom-button2 {
  border-radius: 4px;
  background-color: #F2BE66;
  border: none;
  color: #FFFFFF;
  text-align: center;
  font-size: 11px;
  padding: 15px;
  width: 165px;
  transition: all 0.5s;
  cursor: pointer;
  margin: 5px;
}
   #custom-button2 span{
     cursor: pointer;
     display: inline-block;
     position: relative;
     transition: 0.5s;

}
#custom-button2 span:after{
  content: '\274F';
  position: absolute;
  opacity: 0;
  top: 0;
  right: -20px;
  transition: 0.5s;
}

#custom-button2:hover {
  background-color: #A67624;
}

#custom-button2:hover span{
   padding-right: 25px;
}
#custom-button2:hover span:after{
    opacity: 1;
    right: 0;
}

#custom-text2 {
  margin-left: 10px;
  font-family: sans-serif;
  color: #aaa;
}


#custom-button3 {
  border-radius: 4px;
  background-color: #F2BE66;
  border: none;
  color: #FFFFFF;
  text-align: center;
  font-size: 11px;
  padding: 15px;
  width: 165px;
  transition: all 0.5s;
  cursor: pointer;
  margin: 5px;
}
#custom-button3 span{
     cursor: pointer;
     display: inline-block;
     position: relative;
     transition: 0.5s;

}
#custom-button3 span:after{
  content: '\274F';
  position: absolute;
  opacity: 0;
  top: 0;
  right: -20px;
  transition: 0.5s;
}

#custom-button3:hover {
 background-color: #A67624;
}

#custom-button3:hover span{
   padding-right: 25px;
}
#custom-button3:hover span:after{
    opacity: 1;
    right: 0;
}

#custom-text3 {
  margin-left: 10px;
  font-family: sans-serif;
  color: #aaa;
}

#custom-button4 {
  border-radius: 4px;
  background-color: #F2BE66;
  border: none;
  color: #FFFFFF;
  text-align: center;
  font-size: 11px;
  padding: 15px;
  width: 165px;
  transition: all 0.5s;
  cursor: pointer;
  margin: 5px;
}
#custom-button4 span{
     cursor: pointer;
     display: inline-block;
     position: relative;
     transition: 0.5s;

}
#custom-button4 span:after{
  content: '\274F';
  position: absolute;
  opacity: 0;
  top: 0;
  right: -20px;
  transition: 0.5s;
}

#custom-button4:hover {
 background-color: #A67624;
}

#custom-button4:hover span{
   padding-right: 25px;
}
#custom-button4:hover span:after{
    opacity: 1;
    right: 0;
}

#custom-text4 {
  margin-left: 10px;
  font-family: sans-serif;
  color: #aaa;
}


#custom-button5 {
  border-radius: 4px;
  background-color: #F2BE66;
  border: none;
  color: #FFFFFF;
  text-align: center;
  font-size: 11px;
  padding: 15px;
  width: 165px;
  transition: all 0.5s;
  cursor: pointer;
  margin: 5px;
}
#custom-button5 span{
     cursor: pointer;
     display: inline-block;
     position: relative;
     transition: 0.5s;

}
#custom-button5 span:after{
  content: '\274F';
  position: absolute;
  opacity: 0;
  top: 0;
  right: -20px;
  transition: 0.5s;
}

#custom-button5:hover {
 background-color: #A67624;
}

#custom-button5:hover span{
   padding-right: 25px;
}
#custom-button5:hover span:after{
    opacity: 1;
    right: 0;
}

#custom-text5 {
  margin-left: 10px;
  font-family: sans-serif;
  color: #aaa;
}

.sidenav {
  height: 100%;
  width: 0;
  position: fixed;
  z-index: 1;
  top: 0;
  left: 0;
  background-color: #111;
  overflow-x: hidden;
  transition: 0.5s;
  padding-top: 100px;
  margin-top: 55px;
}

.sidenav a {
  padding: 8px 8px 8px 32px;
  text-decoration: none;
  font-size: 25px;
  color: #818181;
  display: block;
  transition: 0.3s;
}

.sidenav a:hover {
  color: #f1f1f1;
}

.sidenav .closebtn {
  position: absolute;
  top: 0;
  right: 25px;
  font-size: 36px;
  margin-left: 50px;
}

#main {
  transition: margin-left .5s;
  padding: 16px;
}

@media screen and (max-height: 450px) {
  .sidenav {padding-top: 15px;}
  .sidenav a {font-size: 18px;}
}
 .indicator.online {
    background: #28B62C;
    display: inline-block;
     width: 0.65em;
    height: 0.65em;
    border-radius: 50%;
    -webkit-animation: pulse-animation 2s infinite linear;
}@-webkit-keyframes pulse-animation {
	0% { -webkit-transform: scale(1); }
	25% { -webkit-transform: scale(1); }
    50% { -webkit-transform: scale(1.2) }
    75% { -webkit-transform: scale(1); }
    100% { -webkit-transform: scale(1); }
}

.indicator.offline {
    background: #FF4136;
    display: inline-block;
    width: 1em;
    height: 1em;

}



</style>


<div id="mySidenav" class="sidenav">
  <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
  <!--<a href="#">Curso</a>-->
  <a href="{% url 'createstudentfile' %}">Añadir alumno</a>
  <!--<a href="#">Clients</a>-->
  <!--<a href="#">Contact</a>-->
    {% if courses %}


    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Cursos</a>
    <div class="dropdown-menu" style="background-color: #111;">
        {% for course in courses %}
      <a class="dropdown-item" style="background-color: #111;" href="{% url 'files' course.name %}">{{ course.name }}</a>
        {% endfor %}
      <!--<div class="dropdown-divider"></div>-->
      <!--<a class="dropdown-item" href="#">Separated link</a>-->
    </div>

    {% endif %}
</div>

<div id="main">
<div class="row">

        <div class="panel panel-primary filterable">
            {% for message in messages %}

						 <div class="alert alert-{{ message.tags }} alert-dismissible mt-3" role="alert">
						<button type="button" class="close" data-dismiss="alert" aria-label="Close">
						  <span aria-hidden="true">&times;</span>
						</button>
						{{ message }}
					  </div>

						{% endfor %}
            <span style="font-size:30px;cursor:pointer" onclick="openNav()">&#9776; Menú</span>
             <h1 id="header">TFM Presentados</h1><br>
            <div class="panel-heading mb-10">
                <div class="pull-right">
                    <button class="btn btn-info btn-xs btn-filter" style="padding: 2px 4px; "><i class="fas fa-filter"></i><span> Buscar por nombre</span></button>
                    <!--<a type="button" href="{% url 'createstudentfile' %}" class="btn btn-info btn-xs">
                   <i class="fa fa-plus" aria-hidden="true"></i>
                    <span> Añadir Alumno</span>
                    </a>-->
                    <a id="return-files" type="button" href="{% url 'files' %}" class="btn btn-info btn-xs" style="padding: 2px 4px; ">
                   <i class="fab fa-creative-commons-by" aria-hidden="true"></i></i>
                    <span> Acceder a activos</span>
                    </a>

                </div>

            </div>

            <table class="table styled-table">
                <thead class="table" style="color:white">
                    <tr class="filters">
                        <th><input type="text" class="form-control" placeholder="Nombre" style="color:white important!;" disabled></th>
                        <th style="color: rgba(255,255,255,.5);">Estado</th>
                        <th style="color: rgba(255,255,255,.5);">Acciones</th>
                     </tr>
                </thead>
                <tbody>
                {% if files %}
                  {% for file in files %}
                    <tr>
                      <td id="name">{{ file.name }}</td>
                        {% if file.status == "Defendido" %}

                                <!--<td id="path">{{ file.status }}</td>-->
                        <td> <i class="indicator online" style="background: green; "></i> {{ file.status }} </td>

                        {% endif %}

                      <td><a type="button" id="submit" class="btn btn-info btn-sm px-3 view-user-file" data-toggle="modal" data-target="#modalExample" data-name="{{file.name}}" style="padding: 3px 3px; color:white;">
                     <i class="fas fa-eye"></i>
                    </a>
                      </td>
                    </tr>

                 {% block javascript %}


    <div class="modal fade" id="modalExample" data-backdrop="static" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Ver TFM presentado en detalle</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p id="modal_body" >
        </p>
      </div>
      <div class="modal-footer">
          <button type="button" class="btn btn-secondary mt-5" data-dismiss="modal">Cancelar</button>
          <a name="view-user-file" href="{% url 'detailedfile' file.name %}" class="btn btn-primary mt-5">Ver</a>

      </div>
    </div>
    </div>
    </div>


    {% endblock %}

                  {% endfor %}


                {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</div>
</div>

<script>
var url = window.location.href;
console.log(url);


    if ( url.includes("Curso")) {

    var enlace = url.split('filesreaded/')[0];
    var enlace2 = url.split('Curso')[1];

    console.log(enlace)
    console.log(enlace2)
    enlaceFinal = enlace +"files/" + "Curso"+ enlace2;
    console.log(enlaceFinal)
    $("#return-files").attr("href", enlaceFinal);
    año = enlace2.substr(enlace2.length - 9);
    document.getElementById("header").innerHTML = "Alumnos TFM Presentados (" + año +")";

}else{
    console.log("No contiene la palabra curso");
}


function openNav() {
  document.getElementById("mySidenav").style.width = "250px";
  document.getElementById("main").style.marginLeft = "250px";
}

function closeNav() {
  document.getElementById("mySidenav").style.width = "0";
  document.getElementById("main").style.marginLeft= "0";
}

  $(document).ready(function(){
    $('.filterable .btn-filter').click(function(){
        var $panel = $(this).parents('.filterable'),
        $filters = $panel.find('.filters input'),
        $tbody = $panel.find('.table tbody');
        if ($filters.prop('disabled') == true) {
            $filters.prop('disabled', false);
            $filters.first().focus();
        } else {
            $filters.val('').prop('disabled', true);
            $tbody.find('.no-result').remove();
            $tbody.find('tr').show();
        }
    });

    $('.filterable .filters input').keyup(function(e){
        /* Ignore tab key */
        var code = e.keyCode || e.which;
        if (code == '9') return;
        /* Useful DOM data and selectors */
        var $input = $(this),
        inputContent = $input.val().toLowerCase(),
        $panel = $input.parents('.filterable'),
        column = $panel.find('.filters th').index($input.parents('th')),
        $table = $panel.find('.table'),
        $rows = $table.find('tbody tr');
        /* Dirtiest filter function ever ;) */
        var $filteredRows = $rows.filter(function(){
            var value = $(this).find('td').eq(column).text().toLowerCase();
            return value.indexOf(inputContent) === -1;
        });
        /* Clean previous no-result if exist */
        $table.find('tbody .no-result').remove();
        /* Show all rows, hide filtered ones (never do that outside of a demo ! xD) */
        $rows.show();
        $filteredRows.hide();
        /* Prepend no-result row if all rows are filtered */
        if ($filteredRows.length === $rows.length) {
            $table.find('tbody').prepend($('<tr class="no-result text-center"><td colspan="'+ $table.find('.filters th').length +'">No se ha encontrado resultado</td></tr>'));
        }
    });
});

    $(document).on('click', '.view-user-file', function () {
         var name = $(this).attr('data-name');
         var str = name;
         var res = str.split("-")[1];

         console.log(res);

         var enlace = "detailedfile" + "/"+ res ;


         lastNine = url.substr(url.length - 9);
          if ( url.includes("Curso")) {
             header = url.split('filesreaded/')[0];
             console.log(header)
             console.log(url + " Si que contiene Curso en su string");
             enlace = header + "detailedfile/" + res;
             $('#modalExample a[name=view-user-file]').prop('href', enlace);
             $('#modalExample').modal('show');
             console.log(enlace)
         }else{
            console.log(url + "No contiene Curso en su string");
            console.log(enlace);
         $('#modalExample a[name=view-user-file]').prop('href', enlace);
         $('#modalExample').modal('show');
         }

         /*console.log(enlace);
         $('#modalExample a[name=view-user-file]').prop('href', enlace);
         $('#modalExample').modal('show');*/

         document.getElementById("modal_body").innerHTML = "¿Desea ver en detalle el trabajo de "+ name+ " ?";


        });



    const realFileBtn = document.getElementById("id_summary");
    const customBtn = document.getElementById("custom-button");
    const customTxt = document.getElementById("custom-text");

    customBtn.addEventListener("click", function() {
         realFileBtn.click();
    });

    realFileBtn.addEventListener("change", function() {
         if (realFileBtn.value) {
        customTxt.innerHTML = realFileBtn.value.match(/[\/\\]([\w\d\s\.\-\(\)]+)$/)[1];
     } else {
        customTxt.innerHTML = "Ningún archivo seleccionado.";
     }});


    const realFileBtn2 = document.getElementById("id_approval");
    const customBtn2 = document.getElementById("custom-button2");
    const customTxt2 = document.getElementById("custom-text2");

    customBtn2.addEventListener("click", function() {
         realFileBtn2.click();
    });

    realFileBtn2.addEventListener("change", function() {
         if (realFileBtn2.value) {
        customTxt2.innerHTML = realFileBtn2.value.match(/[\/\\]([\w\d\s\.\-\(\)]+)$/)[1];
     } else {
        customTxt2.innerHTML = "Ningún archivo seleccionado.";
     }});


    const realFileBtn3 = document.getElementById("id_modality");
    const customBtn3 = document.getElementById("custom-button3");
    const customTxt3 = document.getElementById("custom-text3");

    customBtn3.addEventListener("click", function() {
         realFileBtn3.click();
    });

    realFileBtn3.addEventListener("change", function() {
         if (realFileBtn3.value) {
        customTxt3.innerHTML = realFileBtn3.value.match(/[\/\\]([\w\d\s\.\-\(\)]+)$/)[1];
     } else {
        customTxt3.innerHTML = "Ningún archivo seleccionado.";
     }});


     const realFileBtn4 = document.getElementById("id_report");
    const customBtn4 = document.getElementById("custom-button4");
    const customTxt4 = document.getElementById("custom-text4");

    customBtn4.addEventListener("click", function() {
         realFileBtn4.click();
    });

    realFileBtn4.addEventListener("change", function() {
         if (realFileBtn4.value) {
        customTxt4.innerHTML = realFileBtn4.value.match(/[\/\\]([\w\d\s\.\-\(\)]+)$/)[1];
     } else {
        customTxt4.innerHTML = "Ningún archivo seleccionado.";
     }});


    const realFileBtn5 = document.getElementById("id_modifications");
    const customBtn5 = document.getElementById("custom-button5");
    const customTxt5 = document.getElementById("custom-text5");

    customBtn5.addEventListener("click", function() {
         realFileBtn5.click();
    });

    realFileBtn5.addEventListener("change", function() {
         if (realFileBtn5.value) {
        customTxt5.innerHTML = realFileBtn5.value.match(/[\/\\]([\w\d\s\.\-\(\)]+)$/)[1];
     } else {
        customTxt5.innerHTML = "Ningún archivo seleccionado.";
     }});




</script>



{% endblock %}
<!-- </CalendarSnippet> -->
